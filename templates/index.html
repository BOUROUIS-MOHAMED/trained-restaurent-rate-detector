<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Restaurant Sentiment Rating â€“ Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='styles.css') }}"
    />
</head>
<body>
<!-- Global loading overlay -->
<div id="overlay" class="overlay hidden">
    <div class="overlay-content">
        <div class="loader"></div>
        <div class="overlay-text-wrapper">
            <p class="overlay-title">Processingâ€¦</p>
            <p id="overlay-text" class="overlay-subtitle">Loadingâ€¦</p>
        </div>
    </div>
</div>

<div class="page">
    <!-- Top bar / header -->
    <header class="header">
        <div class="header-main">
            <h1>Restaurant Sentiment Rating</h1>
            <p>
                A multi-threaded Flask API that scans a Yelp reviews dataset,
                extracts all restaurants, and computes sentiment-based ratings
                (0â€“5) per year using a pre-trained model.
            </p>
            <div class="phase-chips">
                <span class="chip chip-soft">Phase 1: Discover restaurants</span>
                <span class="chip chip-soft">Phase 2: Analyze restaurant sentiment</span>
            </div>
        </div>
        <div class="header-side">
            <div class="endpoint-card">
                <div class="endpoint-label">Endpoints</div>
                <code class="endpoint-code">GET /api/v1/getAllRestaurents</code>
                <code class="endpoint-code">GET /api/v1/getrestaurantrate</code>
            </div>
        </div>
    </header>

    <!-- Main 2-column layout -->
    <main class="layout">
        <!-- LEFT: Restaurants list + Phase 1 traces -->
        <section class="panel">
            <div class="panel-header">
                <div>
                    <h2>Dataset overview (Phase 1)</h2>
                    <p class="muted">
                        Phase 1 â€“ the server spawns threads that scan the dataset
                        by chunks of <strong>100 rows</strong> to extract every
                        restaurant and count its reviews.
                    </p>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-icon">ğŸ“„</div>
                    <div class="stat-text">
                        <span id="stat-total-reviews" class="stat-value">â€“</span>
                        <span class="stat-label">Total reviews</span>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-icon">ğŸ½ï¸</div>
                    <div class="stat-text">
                        <span id="stat-total-restaurants" class="stat-value">â€“</span>
                        <span class="stat-label">Restaurants</span>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-icon">âš™ï¸</div>
                    <div class="stat-text">
                        <span id="stat-total-threads" class="stat-value">â€“</span>
                        <span class="stat-label">Phase 1 threads</span>
                    </div>
                </div>
            </div>

            <!-- Filter -->
            <div class="filter-card">
                <div class="filter-row">
                    <label for="filter-input">Filter by restaurant name or slug</label>
                    <div class="filter-input-wrapper">
                        <span class="filter-icon">ğŸ”</span>
                        <input
                            id="filter-input"
                            type="text"
                            placeholder="Start typing to searchâ€¦"
                            autocomplete="off"
                        />
                    </div>
                </div>
                <p class="muted filter-hint">
                    Names are inferred from the Yelp URL slug
                    (e.g. <code>milk-bar-las-vegas-las-vegas-3</code> â†’ â€œMilk Bar Las Vegas Las Vegas 3â€).
                </p>
            </div>

            <!-- Restaurants table -->
            <div class="table-card">
                <div class="table-header-row">
                    <h3 class="table-title">Restaurants</h3>
                    <p class="table-subtitle muted">
                        Click <strong>Check</strong> on a row to run Phase 2 for that restaurant.
                    </p>
                </div>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Restaurant</th>
                            <th class="cell-center">Reviews</th>
                            <th class="cell-right">Action</th>
                        </tr>
                        </thead>
                        <tbody id="restaurants-table-body">
                        <tr>
                            <td colspan="3" class="muted">
                                Loading restaurants from datasetâ€¦
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Phase 1 thread traces -->
            <details class="thread-details">
                <summary>Show Phase 1 thread traces</summary>
                <p class="muted thread-explainer">
                    Each row below corresponds to one thread that processed a block of
                    100 reviews (or fewer for the last chunk).
                </p>
                <div class="table-wrapper compact">
                    <table class="table thread-table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Rows processed</th>
                            <th>Unique restaurants</th>
                            <th>Duration (ms)</th>
                        </tr>
                        </thead>
                        <tbody id="phase1-threads-table-body">
                        <tr>
                            <td colspan="4" class="muted">
                                Traces will appear here once the dataset is loaded.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </details>
        </section>

        <!-- RIGHT: Analysis details (Phase 2) -->
        <section class="panel panel-secondary">
            <div class="panel-header">
                <div>
                    <h2>Restaurant analysis (Phase 2)</h2>
                    <p class="muted">
                        In Phase 2, the server uses multiple threads to process
                        only the reviews of the selected restaurant (chunks of 100),
                        run the sentiment model, and aggregate per-year ratings
                        for the last 10 years.
                    </p>
                </div>
            </div>

            <!-- Placeholder (when nothing selected yet) -->
            <div id="analysis-placeholder" class="placeholder">
                <div class="placeholder-icon">âœ¨</div>
                <div>
                    <p class="placeholder-title">Select a restaurant to get started</p>
                    <p class="placeholder-text">
                        Choose a row on the left and click <strong>Check</strong>.
                        For that restaurant, the server will:
                    </p>
                    <ul class="placeholder-list">
                        <li>Use the Phase 1 cache to grab only its reviews.</li>
                        <li>Spawn threads that process those reviews in chunks of 100.</li>
                        <li>Apply the sentiment model and aggregate ratings per year (last 10 years).</li>
                    </ul>
                </div>
            </div>

            <!-- Dynamic analysis content -->
            <div id="analysis-content" class="analysis hidden"></div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>
            API endpoints:
            <code>/api/v1/getAllRestaurents</code> &
            <code>/api/v1/getrestaurantrate?name=&lt;name&gt;</code>
        </p>
    </footer>
</div>

<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
